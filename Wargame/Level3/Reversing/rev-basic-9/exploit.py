def rotate_left(data, shift, size):
    shift %= size
    remains = data >> (size - shift)
    body = (data << shift) - (remains << size)
    return body + remains


def main():
    key = b"I_am_KEY"
    ciphertext = bytearray.fromhex("7E7D9A8B252DD53D032B3898279F4FBC2A79007DC42A4F58")
    data = bytes.fromhex(
        "637C777BF26B6FC53001672BFED7AB76CA82C97DFA5947F0ADD4A2AF9CA472C0"
        "B7FD9326363FF7CC34A5E5F171D8311504C723C31896059A071280E2EB27B275"
        "09832C1A1B6E5AA0523BD6B329E32F8453D100ED20FCB15B6ACBBE394A4C58CF"
        "D0EFAAFB434D338545F9027F503C9FA851A3408F929D38F5BCB6DA2110FFF3D2"
        "CD0C13EC5F974417C4A77E3D645D197360814FDC222A908846EEB814DE5E0BDB"
        "E0323A0A4906245CC2D3AC629195E479E7C8376D8DD54EA96C56F4EA657AAE08"
        "BA78252E1CA6B4C6E8DD741F4BBD8B8A703EB5664803F60E613557B986C11D9E"
        "E1F8981169D98E949B1E87E9CE5528DF8CA1890DBFE6426841992D0FB054BB16")

    for offset in range(0, len(ciphertext), 8):
        for _ in range(16):
            for idx in range(7, -1, -1):
                temp = ciphertext[offset + (idx + 1 & 7)]
                ciphertext[offset + (idx + 1 & 7)] = (rotate_left(temp, 5, 8) - data[
                    key[idx] ^ ciphertext[offset + idx]]) & 0xFF

    print(ciphertext.decode())


if __name__ == "__main__":
    main()
